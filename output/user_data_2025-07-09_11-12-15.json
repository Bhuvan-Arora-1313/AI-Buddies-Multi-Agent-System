{
  "timestamp": "2025-07-09_11-12-15",
  "active_window": "firefox",
  "focused_text": "Could not extract AXValue from focused element",
  "clipboard": null,
  "vscode_text": "// Ensure firebase is available globally\nconst firebase = window.firebase;\nconst db = firebase.firestore();\nlet currentUser = null;\nconst SYSTEM_PROMPT = `\nYou are an elite alibi-creator.\nReturn a valid JSON with exactly these keys:\n- \"excuse\" (string, max 50 words)\n- \"believability_score\" (number between 0 and 1)\n- \"chat_log\" (array of 2\u20134 objects with keys: \"sender\" (string), \"message\" (string))\n\nEach chat log object must look like:\n{ \"sender\": \"You\", \"message\": \"your message here\" }\n\nDo not include explanations or markdown. Output raw JSON only.`;\n\nfunction getLocalHistory() {\n  return JSON.parse(localStorage.getItem(\"excuseHistory\") || \"[]\");\n}\n\nfunction saveToLocalHistory(entry) {\n  const history = getLocalHistory();\n  if (!history.find(e => e.id === entry.id)) {\n    history.push(entry);\n    localStorage.setItem(\"excuseHistory\", JSON.stringify(history));\n  }\n}\n\nwindow.signInWithGoogle = function () {\n  const provider = new firebase.auth.GoogleAuthProvider();\n  firebase.auth().signInWithPopup(provider)\n    .then((result) => {\n      const user = result.user;\n    currentUser = user;\n      document.getElementById(\"userInfo\").innerText = `Hello, ${user.displayName}!`;\n\n      const savedKey = localStorage.getItem(user.uid + \"-apiKey\");\n      if (savedKey) document.getElementById(\"apiKey\").value = savedKey;\n\n      document.getElementById(\"apiKey\").addEventListener(\"input\", (e) => {\n        localStorage.setItem(user.uid + \"-apiKey\", e.target.value);\n      });\n      renderTopExcuses();\n    })\n    .catch((error) => {\n      alert(\"Login failed: \" + error.message);\n    });\n};\n\nasync function generateExcuse() {\n  const apiKey = document.getElementById(\"apiKey\").value;\n  const scenario = document.getElementById(\"scenario\").value;\n  const urgency = document.getElementById(\"urgency\").value;\n  const mode = document.getElementById(\"mode\").value;\n  const language = document.getElementById(\"language\").value;\n  const voice = document.getElementById(\"voice\").checked;\n  const output = document.getElementById(\"output\");\n\n  output.innerHTML = \"\u23f3 Asking Gemini (via OpenRouter)...\";\n\n  const tone = mode === \"apology\"\n    ? \"Respond in a guilt\u2011tripping, heartfelt apology tone.\"\n    : \"Respond in a neutral, believable tone.\";\n\n  const langClause = (language === \"en\" || language === \"english\")\n    ? \"\"\n    : `Respond in ${language} language.`;\n\n  const userPrompt = `\n${SYSTEM_PROMPT}\nRespond only with raw JSON \u2014 no Markdown, no explanation.\n\nScenario: ${scenario}\nUrgency: ${urgency}\nTone: ${tone}\n${langClause}\n`.trim();\n\n  try {\n    const response = await fetch(\"https://openrouter.ai/api/v1/chat/completions\", {\n      method: \"POST\",\n      headers: {\n        \"Authorization\": `Bearer ${apiKey}`,\n        \"Content-Type\": \"application/json\",\n        \"HTTP-Referer\": \"http://localhost\",\n        \"X-Title\": \"Excuse Generator\"\n      },\n      body: JSON.stringify({\n        model: \"google/gemini-2.5-flash-lite-preview-06-17\",\n        messages: [\n          { role: \"system\", content: SYSTEM_PROMPT },\n          { role: \"user\", content: userPrompt }\n        ]\n      })\n    });\n\n    const data = await response.json();\n    const text = data.choices?.[0]?.message?.content || \"\";\n\n    const match = text.match(/{[\\s\\S]+}/);\n    if (!match) {\n      output.innerText = \"\u274c Gemini didn't return JSON:\\n\\n\" + text;\n      return;\n    }\n\n    const parsed = JSON.parse(match[0]);\n    const id = btoa(parsed.excuse).slice(0, 12);\n    const entry = { id, ts: Date.now(), ...parsed };\n    await saveToUserHistory(entry);\n \n   \n\n// Save to Firestore instead of localStorage\nasync function saveToUserHistory(entry) {\n  if (!currentUser) return;\n\n  try {\n    const docRef = db.collection(\"users\").doc(currentUser.uid).collection(\"topExcuses\").doc(entry.id);\n    await docRef.set({\n      excuse: entry.excuse,\n      score: entry.believability_score,\n      timestamp: firebase.firestore.FieldValue.serverTimestamp()\n    });\n    console.log(\"\ud83d\udd25 Excuse saved to Firestore:\", entry.excuse);\n  } catch (err) {\n    console.error(\"\u274c Failed to save to Firestore:\", err);\n  }\n}\n   \n\n\n    const chatLogHtml = Array.isArray(parsed.chat_log)\n      ? parsed.chat_log\n          .filter(entry => entry && entry.sender && entry.message)\n          .map(entry => {\n            const isUser = entry.sender.toLowerCase() === \"me\" || entry.sender.toLowerCase() === \"you\";\n            return `\n              <div class=\"chat-bubble ${isUser ? 'me' : 'other'}\">\n                <strong>${entry.sender}:</strong> ${entry.message}\n              </div>`;\n          }).join(\"\")\n      : \"<div class='chat-bubble other'>\u26a0\ufe0f Invalid chat log format</div>\";\n\n    output.innerHTML = `\n      <div class=\"excuse-text\"><strong>Excuse:</strong> ${parsed.excuse}</div>\n      <div class=\"score\"><strong>Believability:</strong> ${parsed.believability_score}</div>\n      <div class=\"chat-log\">${chatLogHtml}</div>\n    `;\n\n    if (voice) {\n      const utterance = new SpeechSynthesisUtterance(parsed.excuse);\n      utterance.lang = language || \"en\";\n      speechSynthesis.speak(utterance);\n    }\n\n  } catch (err) {\n    output.innerText = \"\u274c Error generating excuse:\\n\" + err.message;\n  }\n}\n\nfunction renderTopExcuses() {\n  const list = document.getElementById(\"topExcuses\");\n  list.innerHTML = \"\";\n\n  const user = firebase.auth().currentUser;\n  if (!user) {\n    list.innerHTML = \"<li class='list-group-item'>Login to see your top excuses.</li>\";\n    return;\n  }\n  firebase.firestore()\n    .collection(\"users\")\n    .doc(user.uid)\n    .collection(\"topExcuses\")\n    .orderBy(\"score\", \"desc\")\n    .limit(5)\n    .get()\n    .then(snapshot => {\n      if (snapshot.empty) {\n        list.innerHTML = \"<li class='list-group-item'>No excuses saved yet.</li>\";\n        return;\n      }\n\n      snapshot.forEach(doc => {\n        const data = doc.data();\n        const li = document.createElement(\"li\");\n        li.classList.add(\"list-group-item\");\n        li.textContent = `(${data.score}) ${data.excuse}`;\n        list.appendChild(li);\n      });\n    })\n    .catch(err => {\n      console.error(\"Error loading top excuses:\", err);\n      list.innerHTML = \"<li class='list-group-item text-danger'>Error loading excuses.</li>\";\n    });\n}\n\nfunction triggerEmergency() {\n  const number = document.getElementById(\"emergencyNumber\").value;\n  const message = document.getElementById(\"emergencyMessage\").value;\n  const status = document.getElementById(\"emergencyStatus\");\n\n  const entry = {\n    id: \"emergency-\" + Date.now(),\n    ts: Date.now(),\n    excuse: \"EMERGENCY TRIGGER\",\n    believability_score: 1.0,\n    chat_log: `Sent '${message}' to ${number}`\n  };\n\n  saveToLocalHistory(entry);\n  renderTopExcuses();\n  status.innerText = \"\u2705 Emergency logged locally!\";\n}\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  renderTopExcuses();\n});\nfunction copyExcuse() {\n  const text = document.querySelector(\".excuse-text\")?.innerText?.replace(\"Excuse:\", \"\").trim();\n  if (text) {\n    navigator.clipboard.writeText(text);\n    alert(\"Excuse copied to clipboard!\");\n  } else {\n    alert(\"No excuse to copy!\");\n  }\n}",
  "ocr_text": "@ Firefox File Edit View History Bookmarks Tools Window Help \u00a2 \u00a9 OB 8 OQ 298x.qg> F Q Se \u00a9 Wed Jul9 11:12AM\n\n\u00bb)\n\nee (ica) M Inbox (2,582) - f2023024\u00a2 X > Partition Array Into Two Ar X \u00ab9 DP 15. Partition Equal Sub: X > Partition Equal Subset Sur X___ \u00a9) Meet - ivv-ripv-iav \u2014_X (\u00ae New Tab x + v\nPrediction Monitor\noo \u20ac ~- CaO O G& x2 2 meet.google.com/jvy-ripy-iay?pli=1&authuser=1 7s =\no.\n\u00b0 z\n]\n2\nNi\n\u00a9\nJayant Chandwani BHARGHAVARAM BODDAPATI\n& & &\n\nJAYANT KAPOOR Ragav Krishna Ramesh Kanishk Rai\n\nVARUN RAVICHANDRAN BHAVIKA BABURAJ\n\n& 11:12 AM | jvy-ripy-iay me x: | -8 \u00a9 & ww :\n98O0eEEE20 OF2000' at\n\na mr mh"
}